<Lems>
    
    <!--
${comment}    
    -->

    <Target component="sim_${reference}" />

    <!-- Include core NeuroML2 ComponentType definitions -->

    <Include file="Cells.xml" />
    <Include file="Networks.xml" />
    <Include file="Simulation.xml" />
#foreach ($include in $includes)##
    
    <Include file="${include}" />
#end##
    
    <Include file="${reference}.nml" />

    <!-- End of NeuroML2 content -->
    
#set( $start = -0.1 * $duration )
#set( $end = 1.1 * $duration )

    <Simulation id="sim_${reference}" length="${duration}ms" step="${dt}ms" target="${reference}">

        <Display id="d0" title="${reference}: Membrane potential of a number of cells" timeScale="1ms" xmin="$start" xmax="$end" ymin="$vmin" ymax="$vmax">
            
#foreach ($plot in $plots)##
            <Line id="${plot.cell}" quantity="${plot.quantity}" scale="1mV" color="${plot.colour}" timeScale="1ms" />
#end## 
            
        </Display>
#if ($activity_plots)##   
      
        <Display id="d1" title="${reference}: Activity of a number of cells" timeScale="1ms" xmin="$start" xmax="$end" ymin="-0.1" ymax="1.1">
            
#foreach ($plot in $activity_plots)##
            <Line id="${plot.cell}" quantity="${plot.quantity}" scale="1" color="${plot.colour}" timeScale="1ms" />
#end## 

        </Display>
#end## 

        <OutputFile id="of0" fileName="${reference}.dat">
#foreach ($save in $to_save)##
            <OutputColumn id="${save.cell}_v" quantity="${save.quantity}"/>
#end## 
        </OutputFile>

    </Simulation>


</Lems>
